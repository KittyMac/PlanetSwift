//
// Autogenerated by gaxb at 02:53:18 PM on 01/28/15
//

import UIKit

public class TextView: TextViewBase {

	lazy public var textView = UITextView()
	lazy private var textViewDelegate = TextViewDelegateHelper()
	
	override public var view: UIView {
		get {
            if textView.delegate == nil {
                textView.delegate = textViewDelegate
            }
            return textView
		}
		set {
			if newValue is UITextView {
				textView = newValue as! UITextView
			}
		}
	}
	
	public override func gaxbPrepare() {
		super.gaxbPrepare()
		
		textViewDelegate.delegate = self
		
		if let text = text {
			textView.text = text
		}
		if let fontName = fontName {
            #if os(iOS)
                textView.font = UIFont(name: fontName, size: UIFont.systemFontSize())
            #else
                textView.font = UIFont(name: fontName, size: 18)
            #endif
		}
        if let fontSize = fontSize, textView.font != nil {
            textView.font = textView.font!.withSize(CGFloat(fontSize))
        }
		if let textColor = textColor {
			textView.textColor = textColor
		}
		if let textAlignment = textAlignment {
			textView.textAlignment = NSTextAlignment.fromPlanetUITextAlignment(textAlignment)
		}
		if let selectable = selectable {
			textView.isSelectable = selectable
		}
        #if os(iOS)
            if let editable = editable {
                textView.isEditable = editable
            }
        #endif
        if let tintColor = tintColor {
            textView.tintColor = tintColor
        }
	}
	
	func textViewDidChange(_ textView: UITextView) {
		if onChange != nil {
			doNotification(onChange!)
		}
	}
	
	func textViewDidEndEditing(_ textView: UITextView) {
		if onEndEditing != nil {
			doNotification(onEndEditing!)
		}
	}
	
	func doNotification(_ note: String) {
		let (scopeObject, name) = self.parseNotification(note)
		if name != nil {
			NotificationCenter.default.post(name: Foundation.Notification.Name(rawValue: name!), object: scopeObject)
		}
	}
    
    public func updateText(_ newText: String?) {
        text = newText
        gaxbPrepare()
    }
}

private class TextViewDelegateHelper : NSObject, UITextViewDelegate {
	
	weak var delegate:TextView?
	
	@objc func textViewDidChange(_ textView: UITextView) {
		
		if delegate != nil {
			delegate?.textViewDidChange(textView)
		}
	}
	
	@objc func textViewDidEndEditing(_ textView: UITextView) {
		
		if delegate != nil {
			delegate?.textViewDidChange(textView)
		}
	}
}
